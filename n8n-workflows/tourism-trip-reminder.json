{
  "name": "æ™ºæ…§æ—…æ¸¸ - è¡Œç¨‹æé†’æœåŠ¡",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "tourism/trip-reminder",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "t1",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [200, 300]
    },
    {
      "parameters": {
        "options": { "temperature": 0.7 }
      },
      "id": "t2",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [400, 500]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ æ˜¯è´´å¿ƒçš„æ—…è¡ŒåŠ©æ‰‹ã€‚\n\nè¡Œç¨‹ä¿¡æ¯ï¼š\n- ç›®çš„åœ°ï¼š{{ $json.spotName || 'è¥¿æŸå¡çºªå¿µé¦†' }}\n- å‡ºå‘æ—¥æœŸï¼š{{ $json.startDate || 'æ˜å¤©' }}\n- æé†’ç±»å‹ï¼š{{ $json.reminderType || 'departure' }}\n\nè¯·ç”Ÿæˆæ¸©é¦¨çš„æé†’å†…å®¹ï¼Œè¿”å›JSONï¼š\n{\n  \"title\": \"æé†’æ ‡é¢˜(å¸¦emoji)\",\n  \"greeting\": \"é—®å€™è¯­\",\n  \"mainContent\": \"ä¸»è¦æé†’å†…å®¹\",\n  \"checklist\": [\"å¿…å¸¦ç‰©å“1\", \"å¿…å¸¦ç‰©å“2\", \"å¿…å¸¦ç‰©å“3\"],\n  \"tips\": [\"è´´å¿ƒæç¤º1\", \"è´´å¿ƒæç¤º2\"],\n  \"closing\": \"ç»“æŸè¯­\"\n}\n\nåªè¿”å›JSONã€‚"
      },
      "id": "t3",
      "name": "AIç”Ÿæˆæé†’",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [400, 300]
    },
    {
      "parameters": {
        "jsCode": "const input = $('Webhook').first().json;\nconst spotName = input.spotName || 'è¥¿æŸå¡çºªå¿µé¦†';\nconst startDate = input.startDate || new Date(Date.now() + 86400000).toISOString().split('T')[0];\nconst reminderType = input.reminderType || 'departure';\n\n// æ™¯ç‚¹ä¿¡æ¯\nconst spotInfo = {\n  'è¥¿æŸå¡çºªå¿µé¦†': { openTime: '09:00-17:00', price: 'å…è´¹', tips: 'éœ€æå‰é¢„çº¦ï¼Œå‘¨ä¸€é—­é¦†' },\n  'ç‹¼ç‰™å±±äº”å£®å£«çºªå¿µåœ°': { openTime: '08:00-17:00', price: '80å…ƒ', tips: 'å±±è·¯è¾ƒé™¡ï¼Œç©¿è¿åŠ¨é‹' },\n  'ç™½æ´‹æ·€é›ç¿é˜Ÿçºªå¿µé¦†': { openTime: '08:00-18:00', price: '40å…ƒ', tips: 'å¤å­£è·èŠ±æœ€ç¾' },\n  'å†‰åº„åœ°é“æˆ˜é—å€': { openTime: '08:30-17:30', price: '30å…ƒ', tips: 'åœ°é“å†…è¾ƒçª„' },\n  'è‘£å­˜ç‘çƒˆå£«é™µå›­': { openTime: '08:00-17:00', price: 'å…è´¹', tips: 'å…è´¹å‚è§‚' },\n  'æå¤§é’Šçºªå¿µé¦†': { openTime: '09:00-17:00', price: 'å…è´¹', tips: 'å‘¨ä¸€é—­é¦†' }\n};\n\nconst spot = spotInfo[spotName] || spotInfo['è¥¿æŸå¡çºªå¿µé¦†'];\n\n// è§£æAIç”Ÿæˆçš„å†…å®¹\nlet aiContent = {\n  title: 'ğŸš— å‡ºå‘æé†’',\n  greeting: 'æ‚¨å¥½ï¼',\n  mainContent: `æ‚¨çš„${spotName}ä¹‹æ—…å³å°†å¼€å§‹`,\n  checklist: ['èº«ä»½è¯', 'æ‰‹æœºå……ç”µå®', 'èˆ’é€‚é‹å­', 'é˜²æ™’ç”¨å“', 'é›¨å…·'],\n  tips: ['å»ºè®®æ—©å‡ºå‘é¿å¼€é«˜å³°', 'æå‰æŸ¥çœ‹å¤©æ°”é¢„æŠ¥'],\n  closing: 'ç¥æ—…é€”æ„‰å¿«ï¼'\n};\n\ntry {\n  const aiText = $input.first().json.text || '';\n  const match = aiText.match(/\\{[\\s\\S]*\\}/);\n  if (match) aiContent = JSON.parse(match[0]);\n} catch (e) {}\n\n// æ„å»ºå®Œæ•´æé†’\nconst reminder = {\n  id: 'reminder-' + Date.now(),\n  type: reminderType,\n  title: aiContent.title,\n  greeting: aiContent.greeting,\n  content: {\n    main: aiContent.mainContent,\n    details: [\n      `ğŸ“… å‡ºå‘æ—¥æœŸï¼š${startDate}`,\n      `ğŸ“ ç›®çš„åœ°ï¼š${spotName}`,\n      `â° å¼€æ”¾æ—¶é—´ï¼š${spot.openTime}`,\n      `ğŸ« é—¨ç¥¨ï¼š${spot.price}`,\n      `ğŸ’¡ ç‰¹åˆ«æç¤ºï¼š${spot.tips}`\n    ]\n  },\n  checklist: aiContent.checklist.map((item, i) => ({ id: i + 1, item, checked: false })),\n  tips: aiContent.tips,\n  closing: aiContent.closing,\n  spotInfo: spot,\n  createdAt: new Date().toISOString()\n};\n\nreturn {\n  success: true,\n  reminder\n};"
      },
      "id": "t4",
      "name": "ç»„è£…æé†’",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}"
      },
      "id": "t5",
      "name": "è¿”å›ç»“æœ",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [900, 300]
    }
  ],
  "connections": {
    "Webhook": { "main": [[{ "node": "AIç”Ÿæˆæé†’", "type": "main", "index": 0 }]] },
    "OpenAI Chat Model": { "ai_languageModel": [[{ "node": "AIç”Ÿæˆæé†’", "type": "ai_languageModel", "index": 0 }]] },
    "AIç”Ÿæˆæé†’": { "main": [[{ "node": "ç»„è£…æé†’", "type": "main", "index": 0 }]] },
    "ç»„è£…æé†’": { "main": [[{ "node": "è¿”å›ç»“æœ", "type": "main", "index": 0 }]] }
  },
  "settings": { "executionOrder": "v1" }
}
