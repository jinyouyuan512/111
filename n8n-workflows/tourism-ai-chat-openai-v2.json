{
  "name": "æ™ºæ…§æ—…æ¸¸-AIèŠå¤©(å†€å°æ¸¸)v2",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "tourism/ai-chat",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-001",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.body || {};\nconst question = input.question || 'ä½ å¥½';\n\n// æ²³åŒ—çº¢è‰²æ™¯ç‚¹ä¿¡æ¯\nconst spots = [\n  'ã€è¥¿æŸå¡çºªå¿µé¦†ã€‘æ–°ä¸­å›½ä»è¿™é‡Œèµ°æ¥ï¼Œè§£æ”¾æˆ˜äº‰æ—¶æœŸä¸­å¤®æ‰€åœ¨åœ°ã€‚åœ°å€ï¼šçŸ³å®¶åº„å¸‚å¹³å±±å¿ é—¨ç¥¨ï¼šå…è´¹ å¼€æ”¾æ—¶é—´ï¼š9:00-17:00',\n  'ã€ç‹¼ç‰™å±±äº”å£®å£«çºªå¿µåœ°ã€‘è‹±é›„å£®ä¸¾ï¼Œæ°”å£®å±±æ²³ã€‚åœ°å€ï¼šä¿å®šå¸‚æ˜“å¿ é—¨ç¥¨ï¼š65å…ƒ å¼€æ”¾æ—¶é—´ï¼š8:00-18:00',\n  'ã€ç™½æ´‹æ·€é›ç¿é˜Ÿçºªå¿µé¦†ã€‘ååŒ—æ˜ç ï¼Œæ°´ä¸Šä¼ å¥‡ã€‚åœ°å€ï¼šé›„å®‰æ–°åŒºå®‰æ–°å¿ é—¨ç¥¨ï¼š40å…ƒ å¼€æ”¾æ—¶é—´ï¼š8:00-18:00',\n  'ã€å¡ç½•åå±•è§ˆé¦†ã€‘è’åŸå˜æ—æµ·çš„ç»¿è‰²å¥‡è¿¹ã€‚åœ°å€ï¼šæ‰¿å¾·å¸‚å›´åœºå¿ é—¨ç¥¨ï¼š130å…ƒ å¼€æ”¾æ—¶é—´ï¼šå…¨å¤©',\n  'ã€æå¤§é’Šçºªå¿µé¦†ã€‘é“è‚©æ‹…é“ä¹‰ï¼Œå¦™æ‰‹è‘—æ–‡ç« ã€‚åœ°å€ï¼šå”å±±å¸‚ä¹äº­å¿ é—¨ç¥¨ï¼šå…è´¹ å¼€æ”¾æ—¶é—´ï¼š9:00-16:30',\n  'ã€å†‰åº„åœ°é“æˆ˜é—å€ã€‘åœ°ä¸‹é•¿åŸï¼ŒæŠ—æˆ˜å¥‡è¿¹ã€‚åœ°å€ï¼šä¿å®šå¸‚æ¸…è‹‘åŒº é—¨ç¥¨ï¼š30å…ƒ å¼€æ”¾æ—¶é—´ï¼š8:30-17:30'\n];\n\nconst systemPrompt = `ä½ æ˜¯å†€å°æ¸¸ï¼Œæ²³åŒ—çº¢è‰²æ—…æ¸¸æ™ºèƒ½åŠ©æ‰‹ã€‚ä½ çƒ­æƒ…å‹å¥½ï¼Œå¯¹æ²³åŒ—çš„çº¢è‰²æ™¯ç‚¹éå¸¸äº†è§£ã€‚\n\nä½ å¯ä»¥å¸®åŠ©æ¸¸å®¢ï¼š\n1. ä»‹ç»çº¢è‰²æ™¯ç‚¹çš„å†å²å’Œç‰¹è‰²\n2. æ¨èæ—…æ¸¸è·¯çº¿\n3. æä¾›å‘¨è¾¹ç¾é£Ÿæ¨è\n4. è§£ç­”é—¨ç¥¨ã€å¼€æ”¾æ—¶é—´ç­‰é—®é¢˜\n\nä»¥ä¸‹æ˜¯æ²³åŒ—ä¸»è¦çº¢è‰²æ™¯ç‚¹ä¿¡æ¯ï¼š\n${spots.join('\\n')}\n\nå›ç­”è¦ç®€æ´å‹å¥½ï¼Œä½¿ç”¨emojiå¢åŠ äº²å’ŒåŠ›ã€‚å¦‚æœé—®é¢˜ä¸æ²³åŒ—çº¢è‰²æ—…æ¸¸æ— å…³ï¼Œç¤¼è²Œåœ°å¼•å¯¼ç”¨æˆ·è¯¢é—®ç›¸å…³é—®é¢˜ã€‚`;\n\nreturn [{\n  json: {\n    systemPrompt,\n    question,\n    sessionId: input.sessionId || 'default'\n  }\n}];"
      },
      "id": "code-prepare",
      "name": "å‡†å¤‡æç¤ºè¯",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "resource": "chat",
        "model": "gpt-3.5-turbo",
        "messages": {
          "values": [
            {
              "content": "={{ $json.systemPrompt }}",
              "role": "system"
            },
            {
              "content": "={{ $json.question }}",
              "role": "user"
            }
          ]
        },
        "options": {
          "temperature": 0.7,
          "maxTokens": 1000
        }
      },
      "id": "openai-001",
      "name": "OpenAI Chat",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1.4,
      "position": [650, 300],
      "credentials": {
        "openAiApi": {
          "id": "YOUR_OPENAI_CREDENTIAL_ID",
          "name": "OpenAI API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $('å‡†å¤‡æç¤ºè¯').first().json;\nconst openaiResponse = $input.first().json;\n\nlet answer = '';\nlet type = 'general';\n\ntry {\n  // n8n OpenAI èŠ‚ç‚¹è¿”å›æ ¼å¼\n  answer = openaiResponse.message?.content || openaiResponse.choices?.[0]?.message?.content || openaiResponse.text || '';\n  \n  const ql = (input.question || '').toLowerCase();\n  if (ql.includes('è¥¿æŸå¡') || ql.includes('ç‹¼ç‰™å±±') || ql.includes('ç™½æ´‹æ·€') || ql.includes('æ™¯ç‚¹')) {\n    type = 'spot_info';\n  } else if (ql.includes('è·¯çº¿') || ql.includes('æ¨è') || ql.includes('è¡Œç¨‹')) {\n    type = 'route';\n  } else if (ql.includes('ç¾é£Ÿ') || ql.includes('åƒ') || ql.includes('é¤')) {\n    type = 'food';\n  } else if (ql.includes('å¤©æ°”') || ql.includes('ç©¿')) {\n    type = 'weather';\n  }\n} catch (e) {\n  answer = 'æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å›ç­”è¿™ä¸ªé—®é¢˜ã€‚æ‚¨å¯ä»¥é—®æˆ‘å…³äºæ²³åŒ—çº¢è‰²æ™¯ç‚¹ã€æ—…æ¸¸è·¯çº¿æˆ–å‘¨è¾¹ç¾é£Ÿçš„é—®é¢˜ã€‚';\n}\n\nif (!answer) {\n  answer = 'ğŸ‘‹ æ‚¨å¥½ï¼æˆ‘æ˜¯å†€å°æ¸¸ï¼Œæ²³åŒ—çº¢è‰²æ—…æ¸¸æ™ºèƒ½åŠ©æ‰‹ã€‚è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„ï¼Ÿ';\n}\n\nreturn [{\n  json: {\n    answer: answer,\n    type: type,\n    sessionId: input.sessionId || 'default',\n    suggestions: ['è¥¿æŸå¡æœ‰ä»€ä¹ˆå¿…çœ‹æ™¯ç‚¹ï¼Ÿ', 'æ¨èä¸€æ—¥æ¸¸è·¯çº¿', 'é™„è¿‘æœ‰ä»€ä¹ˆç¾é£Ÿï¼Ÿ'],\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "id": "code-format",
      "name": "æ ¼å¼åŒ–ç»“æœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "id": "respond-001",
      "name": "å“åº”",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1050, 300]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [[{ "node": "å‡†å¤‡æç¤ºè¯", "type": "main", "index": 0 }]]
    },
    "å‡†å¤‡æç¤ºè¯": {
      "main": [[{ "node": "OpenAI Chat", "type": "main", "index": 0 }]]
    },
    "OpenAI Chat": {
      "main": [[{ "node": "æ ¼å¼åŒ–ç»“æœ", "type": "main", "index": 0 }]]
    },
    "æ ¼å¼åŒ–ç»“æœ": {
      "main": [[{ "node": "å“åº”", "type": "main", "index": 0 }]]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1",
  "meta": {
    "instanceId": "local"
  }
}
