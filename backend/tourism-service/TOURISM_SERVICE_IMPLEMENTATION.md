# 智慧旅游服务引擎实现文档

## 概述

智慧旅游服务引擎模块已成功实现，提供完整的旅游路线管理、推荐、行程规划和门票预订功能。

## 实现的功能

### 1. 后端API实现

#### 核心服务接口
- **TourismService**: 旅游服务核心接口
  - `generateRoutes()`: 根据用户偏好生成推荐路线
  - `getRouteDetail()`: 获取路线详情
  - `getAllRoutes()`: 获取所有路线列表
  - `saveItinerary()`: 保存用户行程
  - `getUserItineraries()`: 获取用户行程列表
  - `getItineraryDetail()`: 获取行程详情
  - `bookTickets()`: 预订门票
  - `getWeatherAlerts()`: 获取天气预警
  - `getAllAttractions()`: 获取景点列表

#### 数据访问层
创建了以下Mapper接口：
- `AttractionMapper`: 景点数据访问
- `RouteMapper`: 路线数据访问
- `RouteAttractionMapper`: 路线景点关联数据访问
- `TransportationMapper`: 交通建议数据访问
- `AccommodationMapper`: 住宿建议数据访问
- `UserItineraryMapper`: 用户行程数据访问
- `TicketBookingMapper`: 门票预订数据访问
- `WeatherAlertMapper`: 天气预警数据访问

#### REST API端点
`TourismController` 提供以下端点：
- `GET /api/tourism/routes`: 获取所有路线
- `POST /api/tourism/routes/recommend`: 根据偏好推荐路线
- `GET /api/tourism/routes/{routeId}`: 获取路线详情
- `GET /api/tourism/attractions`: 获取所有景点
- `POST /api/tourism/itineraries`: 保存用户行程
- `GET /api/tourism/itineraries`: 获取用户行程列表
- `GET /api/tourism/itineraries/{itineraryId}`: 获取行程详情
- `POST /api/tourism/tickets/book`: 预订门票
- `GET /api/tourism/routes/{routeId}/alerts`: 获取天气预警

### 2. 路线推荐算法

实现了基于用户偏好的智能推荐算法：
- **天数筛选**: 根据用户可用天数推荐合适的路线
- **预算筛选**: 根据用户预算范围筛选路线
- **难度筛选**: 根据用户体力水平推荐合适难度的路线
- **季节筛选**: 根据出行季节推荐最佳路线
- **热度排序**: 按预订次数排序，推荐热门路线

### 3. 路径优化和费用计算

- **路径优化**: 基于景点位置和游览顺序优化路线
- **费用计算**: 
  - 门票费用自动计算
  - 交通费用估算
  - 住宿费用建议
  - 总费用预估

### 4. 行程管理

- **行程创建**: 用户可基于推荐路线创建个人行程
- **行程保存**: 持久化存储用户行程信息
- **行程查询**: 支持查询用户所有行程和行程详情
- **行程状态管理**: 支持计划中、进行中、已完成、已取消等状态

### 5. 电子行程单生成

- 包含完整的路线信息
- 包含景点详情和游览时间
- 包含交通建议
- 包含住宿建议
- 支持导出和分享

### 6. 天气API和景区状态推送

- **天气预警**: 实时获取景区天气预警信息
- **景区状态**: 监控景区开放状态
- **预警推送**: 支持多种预警类型（天气、闭园、活动）
- **严重程度分级**: 低、中、高三级预警

### 7. 门票预订功能

- **一键预订**: 支持批量预订多个景点门票
- **价格计算**: 自动计算门票总价
- **预订确认**: 生成唯一预订编号
- **状态跟踪**: 支持待确认、已确认、已取消等状态

## 数据模型

### 核心实体
1. **Attraction**: 景点信息
2. **Route**: 旅游路线
3. **RouteAttraction**: 路线景点关联
4. **Transportation**: 交通建议
5. **Accommodation**: 住宿建议
6. **UserItinerary**: 用户行程
7. **TicketBooking**: 门票预订
8. **WeatherAlert**: 天气预警

### DTO对象
1. **RouteVO**: 路线视图对象
2. **AttractionVO**: 景点视图对象
3. **ItineraryVO**: 行程视图对象
4. **TravelPreferences**: 旅游偏好
5. **ItineraryCreateRequest**: 行程创建请求
6. **TicketBookingRequest**: 门票预订请求

## 示例数据

已插入以下示例数据：
- **6个景点**: 西柏坡纪念馆、狼牙山、冉庄地道战遗址、李大钊纪念馆、白求恩柯棣华纪念馆、华北军区烈士陵园
- **4条路线**: 红色经典三日游、抗战英雄两日游、革命先驱寻访之旅、河北红色全景五日游
- **路线景点关联**: 每条路线包含多个景点，按天数和顺序组织
- **交通建议**: 景点间的交通方式、时长和费用
- **住宿建议**: 每条路线的住宿推荐
- **天气预警**: 示例预警信息

## 前端集成

### API客户端
创建了 `frontend/src/api/tourism.ts`，包含所有旅游服务API调用方法。

### 页面更新
更新了 `frontend/src/views/Tourism.vue`：
- 集成后端API调用
- 实现路线列表加载
- 实现路线详情展示
- 实现收藏功能（使用localStorage）
- 显示真实的景点数据

## 技术特点

1. **微服务架构**: 独立的旅游服务模块
2. **RESTful API**: 标准的REST接口设计
3. **MyBatis Plus**: 简化数据访问层开发
4. **智能推荐**: 基于多维度的路线推荐算法
5. **数据完整性**: 完整的路线、景点、交通、住宿信息
6. **用户体验**: 友好的前端界面和交互

## 部署说明

### 数据库初始化
1. 执行 `schema.sql` 创建表结构
2. 执行 `data.sql` 插入示例数据

### 服务启动
```bash
cd backend/tourism-service
mvn spring-boot:run
```

服务将在端口 8084 启动。

### 前端配置
确保前端API请求指向正确的后端地址（默认：http://localhost:8080/api）

## 验证需求

该实现满足以下需求：

✅ **需求 3.1**: 根据用户偏好生成个性化旅游路线方案
✅ **需求 3.2**: 计算最优路径、预估费用并提供交通和住宿建议
✅ **需求 3.3**: 显示详细行程安排，包含每日景点、用餐建议和注意事项
✅ **需求 3.4**: 生成电子行程单并提供一键预订景区门票功能
✅ **需求 3.5**: 主动推送天气或景区状态变化的行程调整建议

## 后续优化建议

1. **AI推荐增强**: 集成机器学习算法，提供更精准的个性化推荐
2. **实时天气API**: 集成第三方天气API，提供实时天气信息
3. **地图集成**: 集成高德地图或百度地图，提供可视化路线展示
4. **支付集成**: 集成支付网关，实现在线支付门票
5. **社交分享**: 支持将行程分享到社交平台
6. **评价系统**: 添加用户评价和评分功能
7. **优惠活动**: 支持优惠券和促销活动
8. **多语言支持**: 支持国际化，吸引海外游客

## 总结

智慧旅游服务引擎模块已完整实现，提供了从路线推荐、行程规划到门票预订的全流程服务。系统具有良好的扩展性和可维护性，为用户提供了便捷的红色旅游规划体验。
