# 图片视频不显示 - 快速修复指南

## 当前状态检查

### ✅ 后端已正常
1. 文件上传成功 - uploads 目录中有文件
2. 数据库记录正确 - media_file 表有记录
3. API 返回正确 - /api/posts 返回图片和视频URL
4. 文件可访问 - HTTP 200 OK

### ❓ 前端显示问题
用户反馈"只有文字"，图片和视频不显示。

## 可能的原因

### 1. 浏览器缓存
前端可能缓存了旧的数据（没有图片/视频的动态）

### 2. 前端未刷新
页面没有重新加载最新数据

### 3. CORS 问题
虽然文件可以访问，但可能有跨域问题

### 4. 前端代码问题
前端可能没有正确渲染图片/视频

## 立即尝试的解决方案

### 方案 1: 硬刷新浏览器 ⭐⭐⭐⭐⭐
**最可能解决问题**

1. 在浏览器中按 `Ctrl + Shift + R` (Windows) 或 `Cmd + Shift + R` (Mac)
2. 或者按 `F12` 打开开发者工具，右键点击刷新按钮，选择"清空缓存并硬性重新加载"

### 方案 2: 清除浏览器缓存
1. 打开浏览器设置
2. 清除浏览器缓存和Cookie
3. 重新打开页面

### 方案 3: 使用诊断工具
打开 `diagnose_posts.html` 文件：
1. 点击"加载最新动态"
2. 查看是否显示图片和视频
3. 检查图片/视频是否有红色或绿色边框
   - 绿色 = 加载成功
   - 红色 = 加载失败

### 方案 4: 检查浏览器控制台
1. 按 `F12` 打开开发者工具
2. 切换到 Console 标签
3. 刷新页面
4. 查看是否有错误信息（特别是 404、CORS 错误）

### 方案 5: 检查 Network 标签
1. 按 `F12` 打开开发者工具
2. 切换到 Network 标签
3. 刷新页面
4. 查找图片/视频请求
5. 检查状态码（应该是 200）

## 详细诊断步骤

### 步骤 1: 验证后端数据
打开浏览器访问：
```
http://localhost:8083/api/posts?page=1&size=5
```

检查返回的 JSON 数据：
- 是否有 `images` 数组？
- 是否有 `video` 对象？
- URL 是否正确？

### 步骤 2: 验证文件访问
直接在浏览器中访问图片URL（从步骤1获取）：
```
http://localhost:8083/uploads/images/2026/01/03/xxx.png
```

- 如果显示图片 = 文件访问正常 ✓
- 如果 404 = 文件不存在 ✗
- 如果 403 = 权限问题 ✗

### 步骤 3: 检查前端代码
打开浏览器开发者工具，在 Console 中执行：
```javascript
// 检查动态数据
fetch('http://localhost:8083/api/posts?page=1&size=5')
  .then(r => r.json())
  .then(d => console.log(d.data[0]))
```

查看第一条动态的数据结构。

### 步骤 4: 检查前端渲染
在 Elements 标签中：
1. 找到动态列表的 DOM 元素
2. 查看是否有 `<img>` 或 `<video>` 标签
3. 检查 `src` 属性是否正确

## 常见问题

### Q: 为什么之前的动态没有图片？
A: 之前 uploads 目录不存在，文件没有真正保存。需要重新上传。

### Q: 新上传的图片也不显示？
A: 可能是浏览器缓存问题，尝试硬刷新。

### Q: 图片URL是对的，但显示不出来？
A: 检查：
1. 文件是否真的存在（在服务器上检查）
2. 文件权限是否正确
3. 浏览器控制台是否有CORS错误

### Q: 视频不显示？
A: 检查：
1. 视频格式是否支持（MP4最兼容）
2. 视频文件是否损坏
3. 浏览器是否支持该视频编码

## 测试文件

### 1. diagnose_posts.html
全面诊断工具，显示所有动态的图片和视频加载状态。

### 2. test_image_upload_simple.html
测试图片上传功能。

### 3. test_video_upload.html
测试视频上传和发布功能。

## 如果还是不行

### 检查清单：
- [ ] 已硬刷新浏览器（Ctrl+Shift+R）
- [ ] 已清除浏览器缓存
- [ ] 已检查浏览器控制台无错误
- [ ] 已验证后端API返回正确数据
- [ ] 已验证文件URL可直接访问
- [ ] 已使用 diagnose_posts.html 测试

### 提供以下信息：
1. 浏览器控制台的错误信息（截图）
2. Network 标签中图片/视频请求的状态
3. 后端 API 返回的完整 JSON 数据
4. 前端页面的截图

## 最可能的解决方案

**99% 的情况下，硬刷新浏览器（Ctrl+Shift+R）就能解决问题！**

浏览器缓存了旧的动态数据（没有图片/视频），硬刷新会强制重新从服务器获取最新数据。
