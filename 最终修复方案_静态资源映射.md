# æœ€ç»ˆä¿®å¤æ–¹æ¡ˆï¼šé™æ€èµ„æºæ˜ å°„é—®é¢˜

## ğŸ” é—®é¢˜ç¡®è®¤

### å·²éªŒè¯çš„äº‹å®
1. âœ… **æ–‡ä»¶ç¡®å®å­˜åœ¨**ï¼š
   ```
   D:\ruler\backend\social-service\uploads\images\2026\01\04\36b56a91-ba57-403d-acd5-6d6d6805e41c.png
   ```

2. âœ… **åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸**ï¼šç«¯å£ 8083

3. âŒ **ä½†æ— æ³•é€šè¿‡URLè®¿é—®**ï¼š
   ```
   http://localhost:8083/uploads/images/2026/01/04/36b56a91-ba57-403d-acd5-6d6d6805e41c.png
   ```

### é—®é¢˜åŸå› 
**é™æ€èµ„æºæ˜ å°„é…ç½®é—®é¢˜**ï¼šè™½ç„¶æ–‡ä»¶å­˜åœ¨ï¼Œä½†Spring Bootçš„é™æ€èµ„æºæ˜ å°„æ²¡æœ‰æ­£ç¡®é…ç½®ï¼Œå¯¼è‡´æ— æ³•é€šè¿‡HTTPè®¿é—®ã€‚

## ğŸ› ï¸ ä¿®å¤å†…å®¹

### 1. å¢å¼º WebMvcConfig çš„é™æ€èµ„æºé…ç½®

**æ–‡ä»¶**ï¼š`backend/social-service/src/main/java/com/jiyi/social/config/WebMvcConfig.java`

**ä¿®æ”¹å†…å®¹**ï¼š
```java
@Override
public void addResourceHandlers(ResourceHandlerRegistry registry) {
    // é…ç½®ä¸Šä¼ æ–‡ä»¶çš„è®¿é—®è·¯å¾„
    String absolutePath = new File(uploadPath).getAbsolutePath();
    // ç¡®ä¿è·¯å¾„ä»¥åˆ†éš”ç¬¦ç»“å°¾
    if (!absolutePath.endsWith(File.separator)) {
        absolutePath += File.separator;
    }
    
    System.out.println("=== é™æ€èµ„æºé…ç½® ===");
    System.out.println("ä¸Šä¼ è·¯å¾„é…ç½®: " + uploadPath);
    System.out.println("ç»å¯¹è·¯å¾„: " + absolutePath);
    System.out.println("æ˜ å°„URL: /uploads/**");
    
    registry.addResourceHandler("/uploads/**")
            .addResourceLocations("file:" + absolutePath)
            .setCachePeriod(0); // ç¦ç”¨ç¼“å­˜ï¼Œæ–¹ä¾¿è°ƒè¯•
}
```

**æ”¹è¿›ç‚¹**ï¼š
- æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- ç¦ç”¨äº†ç¼“å­˜ï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
- ç¡®ä¿è·¯å¾„æ ¼å¼æ­£ç¡®

### 2. å·²æ·»åŠ çš„ CORS é…ç½®

```java
@Override
public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/**")
            .allowedOriginPatterns("*")
            .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS", "HEAD")
            .allowedHeaders("*")
            .allowCredentials(true)
            .maxAge(3600);
}
```

### 3. å·²æ·»åŠ çš„ @CrossOrigin æ³¨è§£

```java
@CrossOrigin(origins = "*", maxAge = 3600)
public class FileUploadController {
    // ...
}
```

## ğŸ“‹ æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤1ï¼šéªŒè¯æ–‡ä»¶å­˜åœ¨

```bash
# åŒå‡»è¿è¡Œ
éªŒè¯æ–‡ä»¶è·¯å¾„.bat
```

åº”è¯¥çœ‹åˆ°ï¼š
- âœ… æ–‡ä»¶å­˜åœ¨
- âœ… ç«¯å£8083æœ‰æœåŠ¡

### æ­¥éª¤2ï¼šé‡å¯ Social Service

```bash
# åŒå‡»è¿è¡Œ
é‡å¯æ–‡ä»¶ä¸Šä¼ æœåŠ¡.bat
```

**é‡è¦**ï¼šæŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
=== é™æ€èµ„æºé…ç½® ===
ä¸Šä¼ è·¯å¾„é…ç½®: uploads
ç»å¯¹è·¯å¾„: D:\ruler\backend\social-service\uploads\
æ˜ å°„URL: /uploads/**
```

### æ­¥éª¤3ï¼šæµ‹è¯•URLè®¿é—®

åœ¨æµè§ˆå™¨åœ°å€æ ç›´æ¥è¾“å…¥ï¼š
```
http://localhost:8083/uploads/images/2026/01/04/36b56a91-ba57-403d-acd5-6d6d6805e41c.png
```

**é¢„æœŸç»“æœ**ï¼šåº”è¯¥ç›´æ¥æ˜¾ç¤ºå›¾ç‰‡

### æ­¥éª¤4ï¼šæµ‹è¯•é¡µé¢éªŒè¯

```bash
# åŒå‡»è¿è¡Œ
æµ‹è¯•å›¾ç‰‡URL.bat
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ‰€æœ‰å›¾ç‰‡æ˜¾ç¤ºæˆåŠŸ
- âœ… Fetch API çŠ¶æ€ç  200

### æ­¥éª¤5ï¼šéªŒè¯ä½œå“è¯¦æƒ…å¼¹çª—

1. æ‰“å¼€å‰ç«¯ï¼šhttp://localhost:3001
2. è¿›å…¥ä¼—åˆ›ç©ºé—´
3. ç‚¹å‡»ä½ ä¸Šä¼ çš„ä½œå“
4. æŸ¥çœ‹è¯¦æƒ…å¼¹çª—ä¸­çš„å›¾ç‰‡

**é¢„æœŸç»“æœ**ï¼šå›¾ç‰‡æ­£å¸¸æ˜¾ç¤º

## ğŸ” æ•…éšœæ’æŸ¥

### å¦‚æœä»ç„¶æ— æ³•è®¿é—®

#### æ£€æŸ¥1ï¼šæŸ¥çœ‹å¯åŠ¨æ—¥å¿—

å¯åŠ¨æœåŠ¡åï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œç¡®è®¤é™æ€èµ„æºé…ç½®æ˜¯å¦æ­£ç¡®ï¼š
```
=== é™æ€èµ„æºé…ç½® ===
ä¸Šä¼ è·¯å¾„é…ç½®: uploads
ç»å¯¹è·¯å¾„: D:\ruler\backend\social-service\uploads\
æ˜ å°„URL: /uploads/**
```

#### æ£€æŸ¥2ï¼šéªŒè¯è·¯å¾„æ˜ å°„

åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•ä¸åŒçš„URLï¼š
```
# æµ‹è¯•1ï¼šå®Œæ•´è·¯å¾„
http://localhost:8083/uploads/images/2026/01/04/36b56a91-ba57-403d-acd5-6d6d6805e41c.png

# æµ‹è¯•2ï¼šæ ¹è·¯å¾„
http://localhost:8083/uploads/

# æµ‹è¯•3ï¼šAPIç«¯ç‚¹
http://localhost:8083/api/upload/image
```

#### æ£€æŸ¥3ï¼šæŸ¥çœ‹Networkæ ‡ç­¾

æ‰“å¼€å¼€å‘è€…å·¥å…· â†’ Network æ ‡ç­¾ï¼š
- æŸ¥çœ‹è¯·æ±‚URLæ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹å“åº”çŠ¶æ€ç 
- æŸ¥çœ‹å“åº”å¤´ä¸­çš„CORSä¿¡æ¯

#### æ£€æŸ¥4ï¼šæ£€æŸ¥æ–‡ä»¶æƒé™

ç¡®ä¿æ–‡ä»¶æœ‰è¯»å–æƒé™ï¼š
```bash
# æŸ¥çœ‹æ–‡ä»¶å±æ€§
attrib backend\social-service\uploads\images\2026\01\04\36b56a91-ba57-403d-acd5-6d6d6805e41c.png
```

## ğŸ¯ å¯èƒ½çš„å…¶ä»–é—®é¢˜

### é—®é¢˜1ï¼šç«¯å£å†²çª

å¦‚æœç«¯å£8083è¢«å…¶ä»–ç¨‹åºå ç”¨ï¼š
```bash
# æŸ¥çœ‹å ç”¨ç«¯å£çš„ç¨‹åº
netstat -ano | findstr :8083

# ç»“æŸè¿›ç¨‹ï¼ˆæ›¿æ¢PIDï¼‰
taskkill /F /PID <PID>
```

### é—®é¢˜2ï¼šé˜²ç«å¢™é˜»æ­¢

æ£€æŸ¥Windowsé˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº†ç«¯å£8083ï¼š
- æ§åˆ¶é¢æ¿ â†’ Windows Defender é˜²ç«å¢™ â†’ é«˜çº§è®¾ç½®
- å…¥ç«™è§„åˆ™ â†’ æ–°å»ºè§„åˆ™ â†’ ç«¯å£ â†’ TCP 8083

### é—®é¢˜3ï¼šè·¯å¾„åˆ†éš”ç¬¦é—®é¢˜

Windowsä½¿ç”¨åæ–œæ  `\`ï¼Œä½†URLä½¿ç”¨æ­£æ–œæ  `/`ã€‚
ç¡®ä¿URLä¸­ä½¿ç”¨æ­£æ–œæ ï¼š
```
âœ… http://localhost:8083/uploads/images/2026/01/04/file.png
âŒ http://localhost:8083/uploads\images\2026\01\04\file.png
```

## ğŸ’¡ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¦‚æœé™æ€èµ„æºæ˜ å°„ä»ç„¶æœ‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸´æ—¶æ–¹æ¡ˆï¼š

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨å¤–éƒ¨å›¾ç‰‡æœåŠ¡

å°†å›¾ç‰‡ä¸Šä¼ åˆ°å›¾åºŠæœåŠ¡ï¼ˆå¦‚ï¼šimgurã€ä¸ƒç‰›äº‘ã€é˜¿é‡Œäº‘OSSï¼‰

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨Base64ç¼–ç 

å°†å›¾ç‰‡è½¬æ¢ä¸ºBase64ç¼–ç ï¼Œç›´æ¥åµŒå…¥åˆ°HTMLä¸­ï¼ˆä¸æ¨èï¼Œæ–‡ä»¶å¤§ï¼‰

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨Nginxä»£ç†

é…ç½®Nginxä½œä¸ºé™æ€èµ„æºæœåŠ¡å™¨ï¼š
```nginx
location /uploads/ {
    alias D:/ruler/backend/social-service/uploads/;
    add_header Access-Control-Allow-Origin *;
}
```

## ğŸ“Š æŠ€æœ¯ç»†èŠ‚

### Spring Boot é™æ€èµ„æºæ˜ å°„åŸç†

1. **ResourceHandler**ï¼šå¤„ç†é™æ€èµ„æºè¯·æ±‚
2. **ResourceLocation**ï¼šæŒ‡å®šèµ„æºæ–‡ä»¶çš„å®é™…ä½ç½®
3. **PathPattern**ï¼šURLåŒ¹é…æ¨¡å¼

### æ˜ å°„å…³ç³»

```
URL: http://localhost:8083/uploads/images/2026/01/04/file.png
     â†“
åŒ¹é…: /uploads/**
     â†“
æ˜ å°„: file:D:/ruler/backend/social-service/uploads/
     â†“
æ–‡ä»¶: D:/ruler/backend/social-service/uploads/images/2026/01/04/file.png
```

### å…³é”®é…ç½®

```java
registry.addResourceHandler("/uploads/**")  // URLæ¨¡å¼
        .addResourceLocations("file:" + absolutePath)  // æ–‡ä»¶ä½ç½®
        .setCachePeriod(0);  // ç¼“å­˜æ—¶é—´
```

## ğŸ“ ä¸‹ä¸€æ­¥

è¯·æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

1. âœ… è¿è¡Œ `éªŒè¯æ–‡ä»¶è·¯å¾„.bat` ç¡®è®¤æ–‡ä»¶å­˜åœ¨
2. âœ… è¿è¡Œ `é‡å¯æ–‡ä»¶ä¸Šä¼ æœåŠ¡.bat` é‡å¯æœåŠ¡
3. âœ… æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œç¡®è®¤é™æ€èµ„æºé…ç½®
4. âœ… åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—®å›¾ç‰‡URL
5. âœ… è¿è¡Œ `æµ‹è¯•å›¾ç‰‡URL.bat` éªŒè¯
6. âœ… å‘Šè¯‰æˆ‘ç»“æœ

---

**ä¿®å¤æ—¶é—´**ï¼š2025-01-04
**é—®é¢˜ç±»å‹**ï¼šé™æ€èµ„æºæ˜ å°„é…ç½®
**å½±å“èŒƒå›´**ï¼šæ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶æ— æ³•è®¿é—®
**ä¼˜å…ˆçº§**ï¼šé«˜
