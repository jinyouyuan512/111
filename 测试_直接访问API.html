<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç›´æ¥æµ‹è¯• API</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .box { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h2 { color: #a0182f; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 6px; overflow-x: auto; }
        .success { color: #52c41a; font-weight: bold; }
        .error { color: #f5222d; font-weight: bold; }
        button { background: #a0182f; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; }
        button:hover { background: #8b1538; }
    </style>
</head>
<body>
    <h1>ğŸ” API æµ‹è¯•å·¥å…·</h1>
    
    <div class="box">
        <h2>æµ‹è¯• 1: ç›´æ¥è®¿é—®åˆ›æ„æœåŠ¡ API</h2>
        <button onclick="testCreativeAPI()">æµ‹è¯•åˆ›æ„æœåŠ¡</button>
        <div id="result1"></div>
    </div>

    <div class="box">
        <h2>æµ‹è¯• 2: æ£€æŸ¥ CORS å“åº”å¤´</h2>
        <button onclick="testCORS()">æ£€æŸ¥ CORS</button>
        <div id="result2"></div>
    </div>

    <div class="box">
        <h2>æµ‹è¯• 3: æ¨¡æ‹Ÿå‰ç«¯è¯·æ±‚</h2>
        <button onclick="testFrontendRequest()">æ¨¡æ‹Ÿå‰ç«¯</button>
        <div id="result3"></div>
    </div>

    <script>
        async function testCreativeAPI() {
            const div = document.getElementById('result1');
            div.innerHTML = '<p>â³ æµ‹è¯•ä¸­...</p>';
            
            try {
                const response = await fetch('http://localhost:8087/api/creative/designs/top?limit=100');
                const data = await response.json();
                
                div.innerHTML = `
                    <p class="success">âœ… API å“åº”æˆåŠŸ</p>
                    <p>çŠ¶æ€ç : ${response.status}</p>
                    <p>ä½œå“æ•°é‡: ${data.data ? data.data.length : 0}</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                div.innerHTML = `
                    <p class="error">âŒ è¯·æ±‚å¤±è´¥</p>
                    <p>é”™è¯¯: ${error.message}</p>
                `;
            }
        }

        async function testCORS() {
            const div = document.getElementById('result2');
            div.innerHTML = '<p>â³ æ£€æŸ¥ä¸­...</p>';
            
            try {
                const response = await fetch('http://localhost:8087/api/creative/designs/top?limit=1');
                
                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                    'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                    'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers'),
                    'Access-Control-Allow-Credentials': response.headers.get('Access-Control-Allow-Credentials')
                };
                
                div.innerHTML = `
                    <p class="success">âœ… CORS å“åº”å¤´</p>
                    <pre>${JSON.stringify(corsHeaders, null, 2)}</pre>
                    ${corsHeaders['Access-Control-Allow-Origin'] ? 
                        '<p class="success">âœ… CORS å·²é…ç½®</p>' : 
                        '<p class="error">âŒ CORS æœªé…ç½®</p>'}
                `;
            } catch (error) {
                div.innerHTML = `
                    <p class="error">âŒ æ£€æŸ¥å¤±è´¥</p>
                    <p>é”™è¯¯: ${error.message}</p>
                `;
            }
        }

        async function testFrontendRequest() {
            const div = document.getElementById('result3');
            div.innerHTML = '<p>â³ æµ‹è¯•ä¸­...</p>';
            
            try {
                // æ¨¡æ‹Ÿå‰ç«¯çš„è¯·æ±‚æ–¹å¼
                const response = await fetch('http://localhost:8087/api/creative/designs/top?limit=100', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                div.innerHTML = `
                    <p class="success">âœ… å‰ç«¯è¯·æ±‚æˆåŠŸ</p>
                    <p>çŠ¶æ€ç : ${response.status}</p>
                    <p>ä½œå“æ•°é‡: ${data.data ? data.data.length : 0}</p>
                    <p>ç¬¬ä¸€ä¸ªä½œå“: ${data.data && data.data[0] ? data.data[0].title : 'æ— '}</p>
                `;
            } catch (error) {
                div.innerHTML = `
                    <p class="error">âŒ å‰ç«¯è¯·æ±‚å¤±è´¥</p>
                    <p>é”™è¯¯: ${error.message}</p>
                    <p>è¿™å¯èƒ½æ˜¯ CORS é—®é¢˜</p>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = () => {
            console.log('é¡µé¢åŠ è½½å®Œæˆ');
            testCreativeAPI();
        };
    </script>
</body>
</html>
