# ✅ 所有服务已启动 - 测试指南

## 📊 当前状态

### 运行中的服务
1. ✅ **Social Service** - 端口 8083
   - 负责文件上传和存储
   - 文件保存路径：`backend/social-service/uploads/`

2. ✅ **Creative Service** - 端口 8087
   - 负责作品数据管理
   - 数据库：`jiyi_creative`

3. ✅ **Frontend** - 端口 3001
   - 用户界面
   - Vite 开发服务器

## 🧪 测试步骤

### 步骤 1：验证服务状态
运行检查脚本：
```batch
✅检查所有服务状态.bat
```

### 步骤 2：测试图片访问

#### 2.1 查找实际的图片文件
```powershell
Get-ChildItem -Path "backend\social-service\uploads\images" -Recurse -Include *.png,*.jpg | Select-Object -First 1 FullName
```

#### 2.2 直接访问图片
复制上面命令输出的文件路径，例如：
```
D:\ruler\backend\social-service\uploads\images\2026\01\04\36b56a91-ba57-403d-acd5-6d6d6805e41c.png
```

转换为URL（替换路径分隔符）：
```
http://localhost:8083/uploads/images/2026/01/04/36b56a91-ba57-403d-acd5-6d6d6805e41c.png
```

在浏览器中访问该URL，应该能看到图片。

### 步骤 3：测试前端页面

#### 3.1 访问首页
```
http://localhost:3001
```

#### 3.2 进入众创空间
点击导航栏的"众创空间"

#### 3.3 查看作品列表
应该能看到作品卡片，每个卡片显示封面图片

#### 3.4 查看作品详情
点击任意作品卡片，应该能看到：
- ✅ 作品详情弹窗打开
- ✅ 显示作品图片（不再是黑色区域）
- ✅ 显示作品信息

### 步骤 4：测试上传功能

#### 4.1 登录
如果未登录，先登录系统

#### 4.2 上传作品
1. 点击"上传作品"按钮
2. 填写作品信息
3. 上传封面图片
4. 上传作品文件
5. 提交作品

#### 4.3 验证上传
1. 返回众创空间
2. 查看新上传的作品
3. 点击查看详情
4. 确认图片正常显示

## 🔍 故障排查

### 问题 1：图片仍然不显示

#### 检查点 1：服务是否正常运行
```batch
✅检查所有服务状态.bat
```

#### 检查点 2：直接访问图片URL
在浏览器中访问：
```
http://localhost:8083/uploads/images/2026/01/04/xxx.png
```

如果能显示，说明后端正常，问题在前端。
如果不能显示，说明后端有问题。

#### 检查点 3：查看浏览器控制台
按 F12 打开开发者工具：
- 查看 Console 标签的错误信息
- 查看 Network 标签的请求详情

#### 检查点 4：查看数据库中的URL
运行 `检查数据库作品数据.sql`，确认URL格式正确。

### 问题 2：端口被占用

如果启动服务时提示端口被占用：

#### 查找占用端口的进程
```powershell
Get-NetTCPConnection -LocalPort 8087 | Select-Object LocalPort, OwningProcess
```

#### 停止进程
```powershell
Stop-Process -Id <进程ID> -Force
```

### 问题 3：前端无法连接后端

#### 检查 Vite 代理配置
打开 `frontend/vite.config.ts`，确认：
```typescript
proxy: {
  '/uploads': {
    target: 'http://localhost:8083',
    changeOrigin: true
  }
}
```

#### 重启前端服务
```batch
# 停止前端
Ctrl+C

# 重新启动
cd frontend
npm run dev
```

## 📝 数据库检查

### 查看最近上传的作品
```sql
USE jiyi_creative;

SELECT 
    id,
    title,
    designer_id,
    cover_image,
    files,
    created_at
FROM design
ORDER BY created_at DESC
LIMIT 10;
```

### 检查URL格式
URL应该是这样的格式：
```
http://localhost:8083/uploads/images/2026/01/04/xxx.png
```

如果格式不对，运行修复SQL：
```sql
-- 修复 cover_image
UPDATE design 
SET cover_image = REPLACE(cover_image, 'http://localhost/uploads', 'http://localhost:8083/uploads')
WHERE cover_image LIKE 'http://localhost/uploads%';

-- 修复 files
UPDATE design 
SET files = REPLACE(files, 'http://localhost/uploads', 'http://localhost:8083/uploads')
WHERE files LIKE '%http://localhost/uploads%';
```

## 🎯 快速测试命令

### 测试 Social Service
```bash
curl http://localhost:8083/uploads/images/2026/01/04/xxx.png
```

### 测试 Creative Service
```bash
curl http://localhost:8087/api/creative/designs?page=1&size=10
```

### 测试前端
```bash
curl http://localhost:3001
```

## 📌 重要提示

1. **文件存储位置**：`backend/social-service/uploads/`
2. **图片URL格式**：`http://localhost:8083/uploads/images/YYYY/MM/DD/xxx.png`
3. **前端代理**：`/uploads` → `http://localhost:8083`
4. **数据库**：`jiyi_creative.design` 表

## 🎉 成功标志

当你看到以下情况时，说明一切正常：

1. ✅ 所有服务正常运行（8083, 8087, 3001）
2. ✅ 直接访问图片URL能显示图片
3. ✅ 前端作品列表显示封面图片
4. ✅ 作品详情弹窗显示完整图片
5. ✅ 浏览器控制台无错误
6. ✅ 上传新作品后能正常显示

**恭喜！所有功能正常运行！** 🎊

## 📞 需要帮助？

如果仍然有问题，请提供：
1. 浏览器控制台的错误信息
2. Network 标签中的请求详情
3. 后端服务的启动日志
4. 数据库中的作品数据（运行 `检查数据库作品数据.sql`）
