<!DOCTYPE html>
<html>
<head>
    <title>测试发布带标签的动态</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>测试发布带标签的动态</h1>
    <button onclick="testPostWithTags()">发布带标签的动态</button>
    <pre id="result"></pre>

    <script>
        async function testPostWithTags() {
            const token = localStorage.getItem('token');
            if (!token) {
                document.getElementById('result').textContent = '请先登录！';
                return;
            }

            const postData = {
                content: '测试热门话题统计功能 - ' + new Date().toLocaleString(),
                tags: ['西柏坡', '红色旅游打卡', '党史学习'],
                location: '西柏坡纪念馆',
                category: 'travel'
            };

            console.log('发送数据:', postData);

            try {
                const response = await fetch('http://localhost:8083/api/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify(postData)
                });

                const result = await response.json();
                console.log('响应:', result);
                document.getElementById('result').textContent = JSON.stringify(result, null, 2);

                if (response.ok) {
                    alert('发布成功！');
                    // 查询热门话题
                    setTimeout(checkHotTopics, 2000);
                }
            } catch (error) {
                console.error('错误:', error);
                document.getElementById('result').textContent = '错误: ' + error.message;
            }
        }

        async function checkHotTopics() {
            try {
                const response = await fetch('http://localhost:8083/api/topics/hot?limit=10');
                const result = await response.json();
                console.log('热门话题:', result);
                document.getElementById('result').textContent += '\n\n热门话题:\n' + JSON.stringify(result, null, 2);
            } catch (error) {
                console.error('查询热门话题失败:', error);
            }
        }
    </script>
</body>
</html>
